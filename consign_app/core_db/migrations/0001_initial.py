# Generated by Django 5.2.7 on 2025-10-04 13:14

import django.db.models.deletion
import uuid
from django.db import migrations, models


class Migration(migrations.Migration):

    initial = True

    dependencies = [
    ]

    operations = [
        migrations.CreateModel(
            name='AuditLog',
            fields=[
                ('created_at', models.DateTimeField(auto_now_add=True, db_index=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('trace_id', models.CharField(blank=True, db_index=True, max_length=255)),
                ('audit_id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('action', models.CharField(max_length=64)),
                ('actor_type', models.CharField(blank=True, max_length=64)),
                ('actor_id', models.CharField(blank=True, max_length=64)),
                ('target_type', models.CharField(blank=True, max_length=64)),
                ('target_id', models.UUIDField(blank=True, null=True)),
                ('at', models.DateTimeField(auto_now_add=True)),
                ('before', models.JSONField(blank=True, default=dict)),
                ('after', models.JSONField(blank=True, default=dict)),
            ],
            options={
                'abstract': False,
            },
        ),
        migrations.CreateModel(
            name='Borrower',
            fields=[
                ('created_at', models.DateTimeField(auto_now_add=True, db_index=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('trace_id', models.CharField(blank=True, db_index=True, max_length=255)),
                ('borrower_id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('name', models.CharField(max_length=255)),
                ('document', models.CharField(db_index=True, max_length=32)),
                ('email', models.EmailField(blank=True, max_length=255)),
                ('phone_number', models.CharField(blank=True, max_length=32)),
                ('kyc_status', models.CharField(blank=True, max_length=32)),
                ('credit_status', models.CharField(blank=True, max_length=32)),
                ('risk_score', models.DecimalField(blank=True, decimal_places=6, max_digits=9, null=True)),
                ('consigned_margin', models.DecimalField(blank=True, decimal_places=2, max_digits=18, null=True)),
            ],
            options={
                'abstract': False,
            },
        ),
        migrations.CreateModel(
            name='Contract',
            fields=[
                ('created_at', models.DateTimeField(auto_now_add=True, db_index=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('trace_id', models.CharField(blank=True, db_index=True, max_length=255)),
                ('contract_id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('instrument', models.CharField(default='ccb', max_length=32)),
                ('creditor_type', models.CharField(default='investor', max_length=32)),
                ('creditor_id', models.UUIDField(blank=True, null=True)),
                ('ccb_number', models.CharField(blank=True, db_index=True, max_length=64)),
                ('status', models.CharField(default='created', max_length=32)),
                ('principal_amount', models.DecimalField(decimal_places=2, max_digits=18)),
                ('rate', models.DecimalField(decimal_places=6, max_digits=9)),
                ('term_months', models.PositiveIntegerField()),
                ('schedule_policy', models.CharField(default='PRICE', max_length=32)),
                ('disbursement_policy', models.CharField(blank=True, max_length=64)),
                ('signature_bundle_id', models.CharField(blank=True, max_length=255)),
                ('document_links', models.JSONField(blank=True, default=dict)),
                ('debt_key', models.CharField(blank=True, db_index=True, max_length=255)),
                ('requester_identifier_key', models.CharField(blank=True, db_index=True, max_length=255)),
                ('signed_at', models.DateTimeField(blank=True, null=True)),
                ('activated_at', models.DateTimeField(blank=True, null=True)),
                ('closed_at', models.DateTimeField(blank=True, null=True)),
                ('idempotency_key', models.CharField(blank=True, db_index=True, max_length=255)),
                ('external_reference', models.CharField(blank=True, db_index=True, max_length=255)),
            ],
            options={
                'abstract': False,
            },
        ),
        migrations.CreateModel(
            name='Document',
            fields=[
                ('created_at', models.DateTimeField(auto_now_add=True, db_index=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('trace_id', models.CharField(blank=True, db_index=True, max_length=255)),
                ('document_id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('owner_type', models.CharField(max_length=32)),
                ('owner_id', models.UUIDField()),
                ('doc_type', models.CharField(max_length=64)),
                ('hash', models.CharField(db_index=True, max_length=128)),
                ('uri', models.CharField(blank=True, max_length=1024)),
                ('version', models.CharField(blank=True, max_length=32)),
                ('status', models.CharField(default='present', max_length=32)),
                ('document_key', models.CharField(blank=True, db_index=True, max_length=255)),
            ],
            options={
                'abstract': False,
            },
        ),
        migrations.CreateModel(
            name='Investor',
            fields=[
                ('created_at', models.DateTimeField(auto_now_add=True, db_index=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('trace_id', models.CharField(blank=True, db_index=True, max_length=255)),
                ('investor_id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('type', models.CharField(max_length=16)),
                ('name', models.CharField(max_length=255)),
                ('document', models.CharField(db_index=True, max_length=32)),
                ('email', models.EmailField(blank=True, max_length=255)),
                ('phone_number', models.CharField(blank=True, max_length=32)),
                ('kyc_status', models.CharField(blank=True, max_length=32)),
                ('suitability_profile', models.CharField(blank=True, max_length=64)),
                ('preferred_payout_method', models.CharField(blank=True, max_length=16)),
                ('status', models.CharField(default='active', max_length=32)),
            ],
            options={
                'abstract': False,
            },
        ),
        migrations.CreateModel(
            name='KycRisk',
            fields=[
                ('created_at', models.DateTimeField(auto_now_add=True, db_index=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('trace_id', models.CharField(blank=True, db_index=True, max_length=255)),
                ('assessment_id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('subject_type', models.CharField(max_length=16)),
                ('subject_id', models.UUIDField()),
                ('provider', models.CharField(default='qi_risk', max_length=64)),
                ('status', models.CharField(default='pending', max_length=32)),
                ('score', models.DecimalField(blank=True, decimal_places=6, max_digits=9, null=True)),
                ('decision_reasons', models.JSONField(blank=True, default=dict)),
                ('evidences', models.JSONField(blank=True, default=dict)),
                ('natural_person_key', models.CharField(blank=True, db_index=True, max_length=255)),
                ('legal_person_key', models.CharField(blank=True, db_index=True, max_length=255)),
                ('external_reference', models.CharField(blank=True, db_index=True, max_length=255)),
            ],
            options={
                'abstract': False,
            },
        ),
        migrations.CreateModel(
            name='LedgerEntry',
            fields=[
                ('created_at', models.DateTimeField(auto_now_add=True, db_index=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('trace_id', models.CharField(blank=True, db_index=True, max_length=255)),
                ('ledger_entry_id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('entry_date', models.DateTimeField(db_index=True)),
                ('debit_account', models.CharField(max_length=64)),
                ('credit_account', models.CharField(max_length=64)),
                ('amount', models.DecimalField(decimal_places=2, max_digits=18)),
                ('currency', models.CharField(default='BRL', max_length=8)),
                ('reference_type', models.CharField(blank=True, max_length=64)),
                ('reference_id', models.UUIDField(blank=True, db_index=True, null=True)),
            ],
            options={
                'abstract': False,
            },
        ),
        migrations.CreateModel(
            name='Reconciliation',
            fields=[
                ('created_at', models.DateTimeField(auto_now_add=True, db_index=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('trace_id', models.CharField(blank=True, db_index=True, max_length=255)),
                ('reconciliation_id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('period_start', models.DateTimeField()),
                ('period_end', models.DateTimeField()),
                ('source', models.CharField(default='bank', max_length=32)),
                ('totals_expected', models.JSONField(blank=True, default=dict)),
                ('totals_actual', models.JSONField(blank=True, default=dict)),
                ('differences', models.JSONField(blank=True, default=dict)),
                ('status', models.CharField(default='open', max_length=16)),
            ],
            options={
                'abstract': False,
            },
        ),
        migrations.CreateModel(
            name='Wallet',
            fields=[
                ('created_at', models.DateTimeField(auto_now_add=True, db_index=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('trace_id', models.CharField(blank=True, db_index=True, max_length=255)),
                ('wallet_id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('owner_type', models.CharField(max_length=32)),
                ('owner_id', models.UUIDField()),
                ('currency', models.CharField(default='BRL', max_length=8)),
                ('available_balance', models.DecimalField(decimal_places=2, default=0, max_digits=18)),
                ('blocked_balance', models.DecimalField(decimal_places=2, default=0, max_digits=18)),
                ('status', models.CharField(default='active', max_length=32)),
                ('external_reference', models.CharField(blank=True, db_index=True, max_length=255)),
                ('account_key', models.CharField(blank=True, db_index=True, max_length=255)),
            ],
            options={
                'abstract': False,
            },
        ),
        migrations.CreateModel(
            name='WebhookEvent',
            fields=[
                ('created_at', models.DateTimeField(auto_now_add=True, db_index=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('trace_id', models.CharField(blank=True, db_index=True, max_length=255)),
                ('event_id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('direction', models.CharField(max_length=16)),
                ('event', models.CharField(db_index=True, max_length=128)),
                ('resource_type', models.CharField(db_index=True, max_length=64)),
                ('resource_id', models.UUIDField(blank=True, db_index=True, null=True)),
                ('occurred_at', models.DateTimeField(db_index=True)),
                ('payload', models.JSONField(blank=True, default=dict)),
                ('signature', models.CharField(blank=True, max_length=255)),
                ('processing_status', models.CharField(default='pending', max_length=16)),
                ('attempts', models.PositiveIntegerField(default=0)),
                ('idempotency_key', models.CharField(blank=True, db_index=True, max_length=255)),
            ],
            options={
                'abstract': False,
            },
        ),
        migrations.CreateModel(
            name='ConsignmentAgreement',
            fields=[
                ('created_at', models.DateTimeField(auto_now_add=True, db_index=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('trace_id', models.CharField(blank=True, db_index=True, max_length=255)),
                ('consignment_agreement_id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('issuer', models.CharField(max_length=64)),
                ('enrollment_id', models.CharField(db_index=True, max_length=64)),
                ('consigned_margin', models.DecimalField(decimal_places=2, default=0, max_digits=18)),
                ('valid_from', models.DateField(blank=True, null=True)),
                ('valid_to', models.DateField(blank=True, null=True)),
                ('status', models.CharField(default='active', max_length=32)),
                ('borrower', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='agreements', to='core_db.borrower')),
            ],
            options={
                'abstract': False,
            },
        ),
        migrations.AddField(
            model_name='borrower',
            name='consignment_agreement',
            field=models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='current_borrowers', related_query_name='current_borrower', to='core_db.consignmentagreement'),
        ),
        migrations.CreateModel(
            name='Disbursement',
            fields=[
                ('created_at', models.DateTimeField(auto_now_add=True, db_index=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('trace_id', models.CharField(blank=True, db_index=True, max_length=255)),
                ('disbursement_id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('method', models.CharField(max_length=16)),
                ('amount', models.DecimalField(decimal_places=2, max_digits=18)),
                ('status', models.CharField(default='processing', max_length=32)),
                ('requested_at', models.DateTimeField(blank=True, null=True)),
                ('settled_at', models.DateTimeField(blank=True, null=True)),
                ('destination_account', models.JSONField(blank=True, default=dict)),
                ('external_reference', models.CharField(blank=True, db_index=True, max_length=255)),
                ('pix_transfer_key', models.CharField(blank=True, db_index=True, max_length=255)),
                ('end_to_end_id', models.CharField(blank=True, db_index=True, max_length=255)),
                ('transaction_key', models.CharField(blank=True, db_index=True, max_length=255)),
                ('idempotency_key', models.CharField(blank=True, db_index=True, max_length=255)),
                ('contract', models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, to='core_db.contract')),
            ],
            options={
                'abstract': False,
            },
        ),
        migrations.CreateModel(
            name='Installment',
            fields=[
                ('created_at', models.DateTimeField(auto_now_add=True, db_index=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('trace_id', models.CharField(blank=True, db_index=True, max_length=255)),
                ('installment_id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('sequence', models.PositiveIntegerField(db_index=True)),
                ('due_date', models.DateField()),
                ('amount_due', models.DecimalField(decimal_places=2, max_digits=18)),
                ('principal_component', models.DecimalField(decimal_places=2, default=0, max_digits=18)),
                ('interest_component', models.DecimalField(decimal_places=2, default=0, max_digits=18)),
                ('fees_component', models.DecimalField(decimal_places=2, default=0, max_digits=18)),
                ('status', models.CharField(default='pending', max_length=32)),
                ('amount_paid', models.DecimalField(decimal_places=2, default=0, max_digits=18)),
                ('paid_at', models.DateTimeField(blank=True, null=True)),
                ('carryover', models.DecimalField(decimal_places=2, default=0, max_digits=18)),
                ('installment_key', models.CharField(blank=True, db_index=True, max_length=255)),
                ('contract', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to='core_db.contract')),
            ],
            options={
                'abstract': False,
            },
        ),
        migrations.CreateModel(
            name='LoanOffer',
            fields=[
                ('created_at', models.DateTimeField(auto_now_add=True, db_index=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('trace_id', models.CharField(blank=True, db_index=True, max_length=255)),
                ('offer_id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('amount', models.DecimalField(decimal_places=2, max_digits=18)),
                ('rate', models.DecimalField(decimal_places=6, max_digits=9)),
                ('term_months', models.PositiveIntegerField()),
                ('valid_until', models.DateField(blank=True, null=True)),
                ('status', models.CharField(default='draft', max_length=32)),
                ('cet', models.DecimalField(blank=True, decimal_places=6, max_digits=9, null=True)),
                ('apr', models.DecimalField(blank=True, decimal_places=6, max_digits=9, null=True)),
                ('fees', models.JSONField(blank=True, default=dict)),
                ('external_reference', models.CharField(blank=True, db_index=True, max_length=255)),
                ('borrower', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to='core_db.borrower')),
            ],
            options={
                'abstract': False,
            },
        ),
        migrations.AddField(
            model_name='contract',
            name='offer',
            field=models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, to='core_db.loanoffer'),
        ),
        migrations.CreateModel(
            name='Payout',
            fields=[
                ('created_at', models.DateTimeField(auto_now_add=True, db_index=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('trace_id', models.CharField(blank=True, db_index=True, max_length=255)),
                ('payout_id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('amount_gross', models.DecimalField(decimal_places=2, default=0, max_digits=18)),
                ('fees_total', models.DecimalField(decimal_places=2, default=0, max_digits=18)),
                ('amount_net', models.DecimalField(decimal_places=2, default=0, max_digits=18)),
                ('method', models.CharField(default='pix', max_length=16)),
                ('status', models.CharField(default='processing', max_length=32)),
                ('requested_at', models.DateTimeField(blank=True, null=True)),
                ('settled_at', models.DateTimeField(blank=True, null=True)),
                ('calculation_period', models.JSONField(blank=True, default=dict)),
                ('items', models.JSONField(blank=True, default=list)),
                ('external_reference', models.CharField(blank=True, db_index=True, max_length=255)),
                ('idempotency_key', models.CharField(blank=True, db_index=True, max_length=255)),
                ('investor', models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, to='core_db.investor')),
            ],
            options={
                'abstract': False,
            },
        ),
        migrations.CreateModel(
            name='Payment',
            fields=[
                ('created_at', models.DateTimeField(auto_now_add=True, db_index=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('trace_id', models.CharField(blank=True, db_index=True, max_length=255)),
                ('payment_id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('source', models.CharField(max_length=32)),
                ('amount', models.DecimalField(decimal_places=2, max_digits=18)),
                ('paid_at', models.DateTimeField()),
                ('status', models.CharField(default='processing', max_length=32)),
                ('external_reference', models.CharField(blank=True, db_index=True, max_length=255)),
                ('raw_payload', models.JSONField(blank=True, default=dict)),
                ('pix_transfer_key', models.CharField(blank=True, db_index=True, max_length=255)),
                ('end_to_end_id', models.CharField(blank=True, db_index=True, max_length=255)),
                ('transaction_key', models.CharField(blank=True, db_index=True, max_length=255)),
                ('request_control_key', models.CharField(blank=True, db_index=True, max_length=255)),
                ('idempotency_key', models.CharField(blank=True, db_index=True, max_length=255)),
                ('contract', models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, to='core_db.contract')),
                ('installment', models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, to='core_db.installment')),
                ('reconciliation_batch', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, to='core_db.reconciliation')),
            ],
            options={
                'abstract': False,
            },
        ),
        migrations.AddField(
            model_name='investor',
            name='primary_wallet',
            field=models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='primary_of', to='core_db.wallet'),
        ),
    ]
